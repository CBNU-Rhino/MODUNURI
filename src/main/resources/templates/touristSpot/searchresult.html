<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>관광지 상세 정보</title>
    <link rel="stylesheet" href="/css/searchresult.css">
    <script type="text/javascript" src="//dapi.kakao.com/v2/maps/sdk.js?appkey=9795bab39c2cc262f3aec7f26ec16196&libraries=services"></script> <!-- 카카오 지도 SDK 추가 -->
</head>
<body>
<div class="main-container">
    <!-- 관광지 정보가 여기에 표시될 예정 -->
    <div id="tourist-spot-info"></div>

    <!-- 지도 섹션 -->
    <div class="section place-map" id="kakao-map" style="width:100%;height:350px;"></div> <!-- 카카오맵이 표시될 영역 -->
</div>

<script>
    // URL에서 contentId와 contentTypeId를 가져옴
    const urlParams = new URLSearchParams(window.location.search);
    const contentId = urlParams.get('contentId');
    const contentTypeId = urlParams.get('contentTypeId');

    if (!contentId || !contentTypeId) {
        document.getElementById('tourist-spot-info').innerHTML = '<p>유효하지 않은 관광지입니다.</p>';
    } else {
        // 선택된 관광지의 상세 정보를 서버에서 가져옴
        const apiUrl = `/touristSpot/Json/tourist-information?contentId=${contentId}&contentTypeId=${contentTypeId}`;

        fetch(apiUrl)
            .then(response => {
                if (!response.ok) {
                    throw new Error('Network response was not ok');
                }
                return response.json();
            })
            .then(data => {
                console.log(data); // API 결과를 콘솔에 출력하여 확인
                if (!data || !data.touristDetail) {
                    document.getElementById('tourist-spot-info').innerHTML = '<p>관광지 정보를 찾을 수 없습니다.</p>';
                    return;
                }

                // 관광지 세부 정보를 페이지에 표시
                const spotInfo = `
                    <div class="section place-image">
                        <img src="${data.touristDetail.firstimage ? data.touristDetail.firstimage : 'placeholder.jpg'}" alt="${data.touristDetail.title}">
                    </div>
                    <div class="section place-name">${data.touristDetail.title}</div>
                    <div class="section place-details">
                        <div class="info-container">
                            <div class="info-left">
                                <h3>장소 정보</h3>
                                <ul>
                                    <li>주소: ${data.touristDetail.addr1 ? data.touristDetail.addr1 : 'N/A'}</li>
                                    <li>전화번호: ${data.touristDetail.tel ? data.touristDetail.tel : 'N/A'}</li>
                                    <li>우편번호: ${data.touristDetail.zipcode ? data.touristDetail.zipcode : 'N/A'}</li>
                                    <li>홈페이지: ${data.touristDetail.homepage ? data.touristDetail.homepage : 'N/A'}</li>
                                    <li>설명: ${data.touristDetail.overview ? data.touristDetail.overview : 'N/A'}</li>
                                </ul>
                            </div>
                            <div class="info-right">
                                <h3>무장애 관광 시설 정보</h3>
                                <ul>
                                    <li>주출입구: ${data.accessibilityInfo?.exit ? data.accessibilityInfo.exit : '정보 없음'}</li>
                                    <li>화장실: ${data.accessibilityInfo?.restroom ? data.accessibilityInfo.restroom : '정보 없음'}</li>
                                    <li>안내견 동반 가능: ${data.accessibilityInfo?.helpdog ? data.accessibilityInfo.helpdog : '정보 없음'}</li>
                                    <li>점자블록: ${data.accessibilityInfo?.braileblock ? data.accessibilityInfo.braileblock : '정보 없음'}</li>
                                    <li>엘리베이터: ${data.accessibilityInfo?.elevator ? data.accessibilityInfo.elevator : '정보 없음'}</li>
                                </ul>
                            </div>
                        </div>
                    </div>
                `;
                document.getElementById('tourist-spot-info').innerHTML = spotInfo;

                // 카카오 맵에 해당 관광지의 위치를 표시 (지도 위치가 존재할 경우에만)
                if (data.touristDetail.mapx && data.touristDetail.mapy) {
                    // 지도와 마커를 설정하는 코드를 fetch 성공 후에 실행
                    const mapContainer = document.getElementById('kakao-map');
                    const mapOption = {
                        center: new kakao.maps.LatLng(data.touristDetail.mapy, data.touristDetail.mapx),
                        level: 3
                    };
                    const map = new kakao.maps.Map(mapContainer, mapOption);
                    const markerPosition = new kakao.maps.LatLng(data.touristDetail.mapy, data.touristDetail.mapx);
                    const marker = new kakao.maps.Marker({
                        position: markerPosition
                    });
                    marker.setMap(map);
                } else {
                    document.getElementById('kakao-map').style.display = 'none'; // 위치 정보가 없으면 지도 숨김
                }
            })
            .catch(error => {
                console.error('Error fetching tourist spot information:', error);
                document.getElementById('tourist-spot-info').innerHTML = '<p>관광지 정보를 불러오는 중 오류가 발생했습니다.</p>';
            });
    }
</script>
</body>
</html>
