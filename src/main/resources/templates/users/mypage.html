<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>My Page</title>
    <link rel="stylesheet" th:href="@{/css/mypage.css}"> <!-- CSS 파일 연결 -->
</head>
<body>
<!-- Header Section -->
<header class="navbar">
    <div class="logo">
        <a href="/"> <!-- 로고 클릭 시 index.html로 이동 -->
            <img src="/images/MODUNURI.png"> <!-- 이미지 추가 -->
            MODUNURI
        </a>
    </div>

    <nav>
        <ul class="nav-links">
            <li><a href="/touristSpot/area-search">지역 별 검색</a></li>
            <li><a href="/touristSpot/search-by-accessibility">무장애 정보 검색</a></li>
            <li><a href="/touristSpot/map">지도 보기</a></li>
            <li><a href="#">여행 기록하기</a></li>
            <!-- 로그인 상태 확인 -->
            <li class="nav-item-right">
                <span th:if="${username != null}">
                    <a href="/users/mypage" class="my-page-button">My Page</a> <!-- My Page 버튼 추가 -->
                    <a th:text="${username} + '님 안녕하세요'"></a>
                    <a href="/users/logout" class="auth-button">Logout</a>
                </span>
                <span th:if="${username == null}">
                    <a href="/users/signup" class="auth-button">Sign Up</a>
                    <a href="/users/login" class="auth-button">Log In</a> <!-- Log In 버튼 추가 -->
                </span>
            </li>
        </ul>
    </nav>
</header>

<!-- Main Content -->
<main class="mypage-container">
    <p th:text="'안녕하세요, ' + ${username} + '님 !'"></p>

    <!-- 관심 관광지 목록 -->
    <section class="favorite-contents">
        <h2 th:text="${username} + '님이 저장한 관광지 목록'">Your Favorite Places</h2>
        <div id="saved-places" class="saved-places">
            <!-- 관심 관광지 목록이 동적으로 추가됩니다 -->
        </div>
        <!-- 빈 목록일 때 보여줄 메시지 -->
        <p id="no-places-message" style="display: none; color: #777; text-align: center;">관광지를 저장해보세요</p>
    </section>

</main>

<!-- Footer Section -->
<footer class="footer">
    <div class="footer-links">
        <ul>
            <li><a href="#">Find a Store</a></li>
            <li><a href="#">Contact Us</a></li>
            <li><a href="#">Privacy Policy</a></li>
            <li><a href="#">Terms of Use</a></li>
        </ul>
    </div>
</footer>

<script>
    window.addEventListener('DOMContentLoaded', (event) => {
        loadSavedPlaces(); // 페이지가 로드될 때 관심 관광지 목록 불러오기
    });

    function loadSavedPlaces() {
        fetch('/users/getFavoriteContents')
            .then(response => response.json())
            .then(favoritePlacesData => {
                const savedPlaces = document.querySelector('#saved-places');
                const noPlacesMessage = document.querySelector('#no-places-message');
                savedPlaces.innerHTML = ''; // 기존 목록을 초기화

                if (Object.keys(favoritePlacesData).length === 0) {
                    noPlacesMessage.style.display = 'block'; // 빈 목록일 때 메시지 표시
                } else {
                    noPlacesMessage.style.display = 'none'; // 목록이 있을 때 메시지 숨김
                    Object.keys(favoritePlacesData).forEach(contentId => {
                        const contentTypeId = favoritePlacesData[contentId];
                        fetch(`/touristSpot/Json/tourist-information?contentId=${contentId}&contentTypeId=${contentTypeId}`)
                            .then(response => response.json())
                            .then(data => {
                                console.log("Tourist information:", data); // 로그 추가
                                displaySavedPlace(data.touristDetail);
                            })
                            .catch(error => console.error("Error fetching tourist information:", error));
                    });
                }
            })
            .catch(error => console.error('Error loading saved places:', error));
    }

    // 저장된 관광지 정보를 표시
    function displaySavedPlace(touristDetail) {
        const savedPlaces = document.querySelector('#saved-places');
        const placeBox = document.createElement('div');
        placeBox.classList.add('place-box');
        placeBox.id = `place-${touristDetail.contentid}`;
        // 관광지 클릭 시 상세 정보 페이지로 이동하는 이벤트
        placeBox.addEventListener('click', () => {
            window.location.href = `/touristSpot/tourist-information?contentId=${touristDetail.contentid}&contentTypeId=${touristDetail.contenttypeid}`;
        });
        const imageUrl = touristDetail.firstimage || '/images/placeholder.png';
        const title = touristDetail.title || "제목 없음";
        const address = touristDetail.addr1 || "주소 없음";

        placeBox.innerHTML = `
        <div class="place-info">
            <img src="${imageUrl}" alt="${title}" class="place-image" />
            <div class="place-text">
                <h4>${title}</h4>
                <p>${address}</p>
                <!-- 동기식 폼을 이용한 삭제 버튼 -->
                <form action="/users/removeFavorite" method="POST">
                    <input type="hidden" name="contentId" value="${touristDetail.contentid}">
                    <button type="submit" class="remove-button">지우기</button>
                </form>
            </div>
        </div>
    `;

        savedPlaces.appendChild(placeBox);
    }
</script>


<script src="/static/script/script.js"></script>
</body>
</html>
